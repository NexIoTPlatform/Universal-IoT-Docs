---
title: 准备一款设备
date: 2025-03-05 21:25:02
permalink: /iot/connected
categories:
  - 设备接入
tags:
  - 设备接入
---

# 设备定义（AI）

本款产品是AI生成，不一定严谨，如有差异，尽请见谅

## 一、设备概述

- **设备名称**：简易智能插座
- **核心功能**：远程控制开关状态、实时上报用电参数（电流/电压/功率）、触发过载报警等事件
- **通信方式**：TCP直连，16进制报文传输

## 二、TCP协议规范

### 1. 通用报文格式（16进制）

| 帧头(2B) | 设备ID(4B)   | 命令码(1B) | 数据长度(1B) | 数据区(NB) | 帧尾(2B) |
| -------- | ------------ | ---------- | ------------ | ---------- | -------- |
| A5A5     | 设备唯一标识 | 功能类型   | 数据区字节数 | 业务数据   | 5A5A     |

- **字段说明**：
  - **帧头**：固定为 `A5A5`（标识报文开始）
  - **设备ID**：4字节16进制字符串（如 `0001` 表示第1台设备）
  - **命令码**：1字节，区分报文类型（见下表）
  - **数据长度**：1字节16进制，标识数据区的字节数（如 `07` 表示7字节）
  - **数据区**：变长，存储属性、事件或控制指令的具体内容
  - **帧尾**：固定为 `5A5A`（标识报文结束）

### 2. 命令码定义

| 命令码(16进制) | 方向 | 含义         | 数据区内容格式                                |
| -------------- | ---- | ------------ | --------------------------------------------- |
| 01             | 上行 | 属性上报     | 开关状态(1B) + 电流(2B) + 电压(2B) + 功率(2B) |
| 02             | 上行 | 事件上报     | 事件类型(1B) + 事件参数(2B)                   |
| 03             | 下行 | 开关控制指令 | 控制类型(1B) + 目标状态(1B)                   |
| 04             | 上行 | 指令响应     | 执行结果(1B)（`00`=成功，`01`=失败）          |

### 3. 数据区详细定义

#### （1）属性上报（命令码01）

- **数据区格式**：`[开关状态(1B)][电流(2B)][电压(2B)][功率(2B)]`

  - 开关状态：`01`=开，`00`=关
  - 电流：2字节16进制，单位 `0.01A`（如 `05DC` → 1500 → 1500×0.01=15.00A）
  - 电压：2字节16进制，单位 `0.1V`（如 `08F0` → 2288 → 2288×0.1=228.8V）
  - 功率：2字节16进制，单位 `1W`（如 `04B0` → 1200 → 1200W）

- **示例报文**：
  ```hex
  A5A5000101070105DC08F004B05A5A
  ```
  - 解析：设备`0001`上报，开关状态为开，电流15.00A，电压228.8V，功率1200W

#### （2）事件上报（命令码02）

- **数据区格式**：`[事件类型(1B)][事件参数(2B)]`

  - 事件类型：`01`=过载报警，`03`=上线，`04`=下线
  - 事件参数：仅过载报警有效，单位`1W`（如 `04B0` → 1200W）

- **示例报文（过载报警）**：
  ```hex
  A5A5000102030104B05A5A
  ```
  - 解析：设备`0001`触发过载报警，当前功率1200W

#### （3）开关控制指令（命令码03）

- **数据区格式**：`[控制类型(1B)][目标状态(1B)]`

  - 控制类型：固定为 `01`（开关控制）
  - 目标状态：`01`=开，`00`=关

- **示例报文（打开开关）**：
  ```hex
  A5A50001030201015A5A
  ```
  - 解析：平台向设备`0001`发送指令，控制开关打开

#### （4）指令响应（命令码04）

- **数据区格式**：`[执行结果(1B)]`

  - 执行结果：`00`=成功，`01`=失败

- **示例报文（执行成功）**：

  ```hex
  A5A500010401005A5A
  ```

  - 解析：设备`0001`响应，确认开关控制指令执行成功

## 三、物模型介绍

#### 属性

![properties](/02/connected/properties.png "properties")

#### 事件

![event](/02/connected/event.png "event")

#### 功能

![fun](/02/connected/fun.png "fun")

#### TSL(metadata)

```json
{
  "tags": [],
  "events": [
    {
      "id": "overload",
      "name": "过载报警",
      "valueType": {
        "type": "int",
        "unit": "W"
      }
    },
    {
      "id": "online",
      "name": "上线",
      "valueType": {
        "type": "string"
      }
    },
    {
      "id": "offline",
      "name": "下线",
      "valueType": {
        "type": "string"
      }
    }
  ],
  "functions": [
    {
      "id": "switch",
      "name": "开关控制",
      "config": false,
      "inputs": [
        {
          "id": "state",
          "valueType": {
            "type": "enum",
            "elements": [
              {
                "text": "开",
                "value": "01"
              },
              {
                "text": "关",
                "value": "00"
              }
            ]
          }
        },
        {
          "id": "deviceId",
          "name": "设备编号",
          "valueType": {
            "type": "string",
            "expands": {
              "maxLength": "50"
            }
          }
        }
      ],
      "output": {}
    }
  ],
  "properties": [
    {
      "id": "powerState",
      "mode": "rw",
      "name": "开关状态",
      "valueType": {
        "type": "enum",
        "elements": [
          {
            "text": "开",
            "value": "01"
          },
          {
            "text": "关",
            "value": "00"
          }
        ]
      }
    },
    {
      "id": "current",
      "mode": "r",
      "name": "电流",
      "valueType": {
        "type": "float",
        "unit": "A"
      }
    },
    {
      "id": "voltage",
      "mode": "r",
      "name": "电压",
      "valueType": {
        "type": "float",
        "unit": "V"
      }
    },
    {
      "id": "power",
      "mode": "r",
      "name": "功率",
      "valueType": {
        "type": "int",
        "unit": "W"
      }
    }
  ]
}
```

# 总结
