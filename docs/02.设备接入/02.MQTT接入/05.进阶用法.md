---
title: 5.进阶用法
date: 2025-08-02 01:25:02
permalink: /iot/mqtt/more
categories:
  - 设备接入
tags:
  - 设备接入
---

## 1、控制台设置下行Topic主题

:::warning 注意 {open}

设置的主题必须拥有发布`pub`权限

:::

![downTopic](/02/mqtt/downTopic.png "downTopic")

设置后，此产品的将不再向默认物模型主题（`$thing/down/${productKey}/${deviceId}`）推送消息

## 2、编解码协议手动修改

在编解码动态填写的主题

![updatetopic](/02/mqtt/updatetopic.png "updatetopic")

```javascript
//解码
var decode = payload => {
  var result = [];
  log.info("编解码收到消息={}", payload);
  var dt = toJson(payload);
  var propertiesObj = {
    messageType: "PROPERTIES",
    properties: {},
  };
  //设置属性
  propertiesObj.properties = dt;
  propertiesObj.properties.sn = randomSign();
  //MQTT设置回复
  propertiesObj.replyPayload = "xzzxc" + randomSign(); //设置回复的内容
  propertiesObj.downTopic = "$thing/down/681c0775c2dc427d0480ab5f/cz001923"; //设置回复的主题

  return propertiesObj;
};
```

解码后的报文

```json
{
  "messageType": "PROPERTIES",
  "properties": {
    "temp": 1,
    "sn": "23176"
  },
  "replyPayload": "xzzxc23177",
  "downTopic": "$thing/down/681c0775c2dc427d0480ab5f/cz001923"
}
```

预期的结果，平台会自动解析`downTopic` 和 `replyPayload`

:::warning 注意！ {open}

- `downTopic`会覆盖默认物模型的下行主题
- `replyPayload` 值不为空时，平台会立即往设置的 downTopic 发送replyPayload的值。

:::

## 3、更多

- 用以上的规则，你可以做设置灵敏度极高的联动
- 后续支持通知推送，让你更快响应设备的消息
