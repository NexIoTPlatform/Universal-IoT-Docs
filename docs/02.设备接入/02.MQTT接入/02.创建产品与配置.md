---
title: 2.创建产品与配置
date: 2025-03-05 21:25:02
permalink: /iot/mqtt/createProduct
categories:
  - 设备接入
tags:
  - 设备接入
---

# 主要步骤

::: details 必看 {open}

- 1.创建产品-选择 `MQTT`
- 2.导入物模型
- 3.开始上报数据
  :::

## 1、创建产品

![mqttCreate](/02/mqtt/mqttCreate.png "mqttCreate")

### 比较懒，开启主动注册

![autoRe](/02/mqtt/autoRe.png "autoRe")

## 2、导入物模型

![importtsl](/02/mqtt/importtsl.png "importtsl")

> 点击下边->直接复制

```json
{
  "tags": [],
  "events": [
    { "id": "overload", "name": "过载报警", "valueType": { "type": "int", "unit": "W" } },
    { "id": "online", "name": "上线", "valueType": { "type": "string" } },
    { "id": "offline", "name": "下线", "valueType": { "type": "string" } }
  ],
  "functions": [
    {
      "id": "switch",
      "name": "开关控制",
      "config": false,
      "inputs": [
        {
          "id": "state",
          "valueType": {
            "type": "enum",
            "elements": [
              { "text": "开", "value": "01" },
              { "text": "关", "value": "00" }
            ]
          }
        },
        { "id": "deviceId", "name": "设备编号", "valueType": { "type": "string", "expands": { "maxLength": "50" } } }
      ],
      "output": {}
    }
  ],
  "properties": [
    {
      "id": "powerState",
      "mode": "rw",
      "name": "开关状态",
      "valueType": {
        "type": "enum",
        "elements": [
          { "text": "开", "value": "01" },
          { "text": "关", "value": "00" }
        ]
      }
    },
    { "id": "current", "mode": "r", "name": "电流", "valueType": { "type": "float", "unit": "A" } },
    { "id": "voltage", "mode": "r", "name": "电压", "valueType": { "type": "float", "unit": "V" } },
    { "id": "power", "mode": "r", "name": "功率", "valueType": { "type": "int", "unit": "W" } }
  ]
}
```

## 3、设置MQTT参数

在产品侧，MQTT不用额外设置

### 3.1 MQTT认证

像EMQX认证有Mysql、http等多种认证的实现，我这里主要用mysql的账号和密码acl方式，设置账号的主题在一定的规则下面发布和订阅权限。

假设你是某产品${productKey}的开发者，那么平台侧分配你的用户和密码的规则

::: tip mqtt权限设置

物模型主题

- $thing/up/event/${productKey}/+
- $thing/up/property/${productKey}/+
- $thing/down/${productKey}/+

透传主题

- $thing/up/${productKey}/+
- $thing/down/${productKey}/+

:::

在后续版本中会集成 http的实现，那么只需一次配置就不用手动分配账号了。
